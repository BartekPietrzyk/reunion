<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zjazd Przyjaciół - Planer Miejscówki i Ankiety (Offline)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f5f5f4;
            font-family: 'Inter', sans-serif;
        }
        .region-btn.active, .vote-btn.active, .date-btn.active, .price-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #2563eb;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
            
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="font-sans text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">
        
        <!-- Nowa struktura nagłówka z separatorem kodu i tytułu -->
        <div class="flex flex-col items-center mb-8">
            <!-- Pole na kod w pierwszej linii, wyrównane do prawej -->
            <div class="w-full flex justify-end mb-4">
                <div class="flex items-center space-x-2">
                    <input type="password" id="secret-code-input" class="w-24 p-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Kod">
                    <button id="show-stats-btn" class="p-1 text-sm bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">OK</button>
                </div>
            </div>
            
            <!-- Nagłówek i opis poniżej, wyśrodkowane -->
            <header class="text-center w-full">
                <h1 class="text-4xl font-bold text-stone-800">Zjazd Przyjaciół po Latach</h1>
                <p class="text-lg text-stone-600 mt-2">Interaktywny planer, który pomoże nam wybrać idealne miejsce na spotkanie!</p>
            </header>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <h2 class="text-2xl font-semibold text-center text-stone-700 mb-4">Mapa Propozycji</h2>
            <p class="text-center text-stone-500 mb-6">Polska została podzielona na 9 regionów. Kliknij na dowolny z nich, aby zobaczyć dwie propozycje hoteli, które spełniają nasze kryteria: mogą pomieścić 12 osób, oferują dobre jedzenie i miłą atmosferę. Każda propozycja zawiera wycenę weekendowego pobytu.</p>
            <div id="region-grid" class="grid grid-cols-3 gap-2 sm:gap-4">
                <!-- Region buttons will be generated by JavaScript -->
            </div>
        </div>

        <div id="details-container">
             <div class="text-center p-8 bg-white rounded-2xl shadow-lg">
                <svg class="mx-auto h-12 w-12 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 100-6 3 3 0 000 6z" />
                </svg>
                <h3 class="mt-2 text-xl font-medium text-gray-900">Wybierz region</h3>
                <p class="mt-1 text-stone-500">Kliknij na mapie, aby zobaczyć szczegóły propozycji.</p>
            </div>
        </div>
        
        <div class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold text-center text-stone-700 mb-4">Ankieta Wyboru Regionu</h2>
            <p class="text-center text-stone-500 mb-6">Oddaj swój głos na ulubione regiony (możesz wybrać więcej niż jeden).</p>
            
            <form id="region-vote-form" class="space-y-4">
                <div class="flex flex-col">
                    <label for="voter-name-region" class="font-medium text-stone-700 mb-1">Twoje imię:</label>
                    <input type="text" id="voter-name-region" class="p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Wprowadź swoje imię" required>
                </div>
                
                <div class="flex flex-col">
                    <label class="font-medium text-stone-700 mb-1">Wybierz region(y):</label>
                    <div id="vote-region-buttons" class="grid grid-cols-3 gap-2">
                        <!-- Vote buttons will be generated by JS -->
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <button type="submit" id="submit-region-vote-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                        Wyślij Głos
                    </button>
                </div>
                <p id="region-vote-message" class="text-center text-sm font-semibold mt-2"></p>
            </form>

            <form id="add-region-form" class="mt-4 flex flex-col space-y-2">
                <label for="new-region-name" class="font-medium text-stone-700 mb-1">Dodaj nowy region do ankiety:</label>
                <div class="flex space-x-2">
                    <input type="text" id="new-region-name" class="flex-grow p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Nazwa regionu" required>
                    <button type="submit" id="add-region-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-200">
                        Dodaj
                    </button>
                </div>
                <p id="add-region-message" class="text-center text-sm font-semibold mt-1"></p>
            </form>
            
            <div id="region-results-container" class="mt-8">
                <h3 class="text-xl font-semibold text-stone-700 mb-4 text-center">Aktualne Wyniki Głosowania na Region</h3>
                <div id="region-vote-results" class="bg-stone-50 p-4 rounded-lg shadow-inner">
                    <p class="text-center text-stone-500">Brak oddanych głosów. Bądź pierwszy!</p>
                </div>
            </div>

            <!-- Reset panel -->
            <div class="mt-6 border-t pt-6 border-stone-200">
                <h4 class="text-lg font-semibold text-stone-700 mb-3">Zresetuj Ankietę</h4>
                <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
                    <input type="password" id="region-reset-code" class="w-full sm:w-1/3 p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400" placeholder="Kod resetujący">
                    <button id="reset-region-btn" class="w-full sm:w-auto bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition-colors duration-200">
                        Zresetuj
                    </button>
                </div>
                <p id="region-reset-message" class="text-center text-sm font-semibold mt-2"></p>
            </div>
        </div>

        <div class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold text-center text-stone-700 mb-4">Ankieta Wyboru Terminu</h2>
            <p class="text-center text-stone-500 mb-6">Wybierz weekend(y), który(e) najbardziej Ci odpowiadają na zjazd (możesz wybrać więcej niż jeden).</p>

            <form id="weekend-vote-form" class="space-y-4">
                <div class="flex flex-col">
                    <label for="voter-name-weekend" class="font-medium text-stone-700 mb-1">Twoje imię:</label>
                    <input type="text" id="voter-name-weekend" class="p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Wprowadź swoje imię" required>
                </div>

                <div class="flex flex-col">
                    <label class="font-medium text-stone-700 mb-1">Wybierz termin(y):</label>
                    <div id="vote-weekend-buttons" class="grid grid-cols-2 gap-2 sm:grid-cols-3">
                        <!-- Weekend buttons will be generated by JS -->
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <button type="submit" id="submit-weekend-vote-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                        Wyślij Głos
                    </button>
                </div>
                <p id="weekend-vote-message" class="text-center text-sm font-semibold mt-2"></p>
            </form>

            <form id="add-weekend-form" class="mt-4 flex flex-col space-y-2">
                <label for="new-weekend-name" class="font-medium text-stone-700 mb-1">Dodaj nowy termin do ankiety:</label>
                <div class="flex space-x-2">
                    <input type="text" id="new-weekend-name" class="flex-grow p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="np. 1-3 Grudnia" required>
                    <button type="submit" id="add-weekend-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-200">
                        Dodaj
                    </button>
                </div>
                <p id="add-weekend-message" class="text-center text-sm font-semibold mt-1"></p>
            </form>

            <div id="weekend-results-container" class="mt-8">
                <h3 class="text-xl font-semibold text-stone-700 mb-4 text-center">Aktualne Wyniki Głosowania na Termin</h3>
                <div id="weekend-vote-results" class="bg-stone-50 p-4 rounded-lg shadow-inner">
                    <p class="text-center text-stone-500">Brak oddanych głosów. Bądź pierwszy!</p>
                </div>
            </div>

            <!-- Reset panel -->
            <div class="mt-6 border-t pt-6 border-stone-200">
                <h4 class="text-lg font-semibold text-stone-700 mb-3">Zresetuj Ankietę</h4>
                <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
                    <input type="password" id="weekend-reset-code" class="w-full sm:w-1/3 p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400" placeholder="Kod resetujący">
                    <button id="reset-weekend-btn" class="w-full sm:w-auto bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition-colors duration-200">
                        Zresetuj
                    </button>
                </div>
                <p id="weekend-reset-message" class="text-center text-sm font-semibold mt-2"></p>
            </div>
        </div>
        
        <div class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold text-center text-stone-700 mb-4">Ankieta Wyboru Ceny</h2>
            <p class="text-center text-stone-500 mb-6">Oddaj swój głos na preferowane przedziały cenowe za nocleg (za osobę, za dobę) (możesz wybrać więcej niż jeden).</p>

            <form id="price-vote-form" class="space-y-4">
                <div class="flex flex-col">
                    <label for="voter-name-price" class="font-medium text-stone-700 mb-1">Twoje imię:</label>
                    <input type="text" id="voter-name-price" class="p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Wprowadź swoje imię" required>
                </div>
                
                <div class="flex flex-col">
                    <label class="font-medium text-stone-700 mb-1">Wybierz przedział(y) cenowe:</label>
                    <div id="vote-price-buttons" class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                        <!-- Price buttons will be generated by JS -->
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <button type="submit" id="submit-price-vote-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                        Wyślij Głos
                    </button>
                </div>
                <p id="price-vote-message" class="text-center text-sm font-semibold mt-2"></p>
            </form>

            <form id="add-price-form" class="mt-4 flex flex-col space-y-2">
                <label for="new-price-name" class="font-medium text-stone-700 mb-1">Dodaj nowy przedział cenowy do ankiety:</label>
                <div class="flex space-x-2">
                    <input type="text" id="new-price-name" class="flex-grow p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="np. 350-400 zł" required>
                    <button type="submit" id="add-price-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-200">
                        Dodaj
                    </button>
                </div>
                <p id="add-price-message" class="text-center text-sm font-semibold mt-1"></p>
            </form>

            <div id="price-results-container" class="mt-8">
                <h3 class="text-xl font-semibold text-stone-700 mb-4 text-center">Aktualne Wyniki Głosowania na Cenę</h3>
                <div id="price-vote-results" class="bg-stone-50 p-4 rounded-lg shadow-inner">
                    <p class="text-center text-stone-500">Brak oddanych głosów. Bądź pierwszy!</p>
                </div>
            </div>

            <!-- Reset panel -->
            <div class="mt-6 border-t pt-6 border-stone-200">
                <h4 class="text-lg font-semibold text-stone-700 mb-3">Zresetuj Ankietę</h4>
                <div class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
                    <input type="password" id="price-reset-code" class="w-full sm:w-1/3 p-2 border border-stone-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400" placeholder="Kod resetujący">
                    <button id="reset-price-btn" class="w-full sm:w-auto bg-red-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-red-700 transition-colors duration-200">
                        Zresetuj
                    </button>
                </div>
                <p id="price-reset-message" class="text-center text-sm font-semibold mt-2"></p>
            </div>
        </div>
        
        <!-- Secret Stats Panel -->
        <div id="stats-container" class="mt-8 bg-gray-800 text-white p-6 rounded-2xl shadow-lg hidden">
            <h2 class="text-2xl font-semibold text-center text-gray-200 mb-4">Statystyki Odwiedzin</h2>
            <div class="text-center">
                <p class="text-lg">Ta strona została odwiedzona <span id="visit-count" class="font-bold text-blue-400">0</span> razy.</p>
                <p class="text-sm text-gray-400 mt-2">Powyższe dane są zapisywane w pamięci przeglądarki (localStorage) i liczą odwiedziny na tym konkretnym urządzeniu.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Data for regions, hotels, dates, and prices
        const hotelData = {
            'nw': { name: 'Północny-Zachód', hotels: [
                { name: 'Hotel Orle Gniazdo, Szczyrk', desc: 'Położony w sercu Beskidów...', priceSingle: 'ok. 9 600 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 7 800 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 325 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Orle+Gniazdo+Szczyrk' },
                { name: 'Pałac Ciekocinko Hotel Resort & Wellness', desc: 'Luksusowy wypoczynek w butikowym hotelu...', priceSingle: 'ok. 11 500 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 9 200 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 383 PLN', googleMapsLink: 'https://www.google.com/maps/place/Pa%C5%82ac+Ciekocinko' }
            ]},
            'n': { name: 'Północ', hotels: [
                { name: 'Hotel Aubrecht, Kaszuby', desc: 'Elegancki hotel nad jeziorem...', priceSingle: 'ok. 10 200 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 8 400 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 350 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Aubrecht' },
                { name: 'Hotel Mikołajki, Mazury', desc: 'Położony na Ptasiej Wyspie...', priceSingle: 'ok. 10 800 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 8 900 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 371 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Miko%C5%82ajki+Leisure+%26+SPA' }
            ]},
            'ne': { name: 'Północny-Wschód', hotels: [
                { name: 'Hotel Żubrówka, Białowieża', desc: 'Bezpośrednie sąsiedztwo Puszczy Białowieskiej...', priceSingle: 'ok. 8 800 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 7 100 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 296 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+%C5%BBubr%C3%B3wka' },
                { name: 'Dwór Kaliszki, Mazury', desc: 'Zabytkowy dworek z duszą...', priceSingle: 'ok. 9 300 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 7 500 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 313 PLN', googleMapsLink: 'https://www.google.com/maps/place/Dw%C3%B3r+Kaliszki' }
            ]},
            'w': { name: 'Zachód', hotels: [
                { name: 'Pałac Mierzęcin Wellness & Wine Resort', desc: 'Połączenie luksusowego spa z winnicą...', priceSingle: 'ok. 11 000 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 9 000 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 375 PLN', googleMapsLink: 'https://www.google.com/maps/place/Pa%C5%82ac+Mierzecin+Wellness+%26+Wine+Resort' },
                { name: 'Hotel Remes, Opalenica', desc: 'Nowoczesny kompleks sportowo-rekreacyjny...', priceSingle: 'ok. 9 500 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 7 700 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 321 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Remes' }
            ]},
            'c': { name: 'Centrum', hotels: [
                { name: 'Hotel BoniFaCio Spa & Sport Resort', desc: 'Położony wśród lasów niedaleko Warszawy...', priceSingle: 'ok. 10 500 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 8 600 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 358 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+BoniFaCio+SPA+%26+SPORT+Resort' },
                { name: 'Fabryka Wełny Hotel & Spa, Pabianice', desc: 'Unikalny hotel w zrewitalizowanych wnętrzach fabrycznych...', priceSingle: 'ok. 8 500 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 6 900 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 288 PLN', googleMapsLink: 'https://www.google.com/maps/place/Fabryka+We%C5%82ny+Hotel+%26+Spa' }
            ]},
            'e': { name: 'Wschód', hotels: [
                { name: 'Hotel Król Kazimierz, Kazimierz Dolny', desc: 'Stylowy hotel z widokiem na Wisłę...', priceSingle: 'ok. 9 800 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 8 000 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 333 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Krol+Kazimierz' },
                { name: 'Siedlisko Sobibór, Polesie', desc: 'Kameralne miejsce w sercu Poleskiego Parku Narodowego...', priceSingle: 'ok. 8 200 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 6 600 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 275 PLN', googleMapsLink: 'https://www.google.com/maps/place/Siedlisko+Sobib%C3%B3r' }
            ]},
            'sw': { name: 'Południowy-Zachód', hotels: [
                { name: 'Zamek Kliczków', desc: 'Historyczny zamek otoczony fosą...', priceSingle: 'ok. 10 100 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 8 300 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 346 PLN', googleMapsLink: 'https://www.google.com/maps/place/Zamek+Kliczk%C3%B3w' },
                { name: 'Hotel Polanica Resort & Spa, Polanica-Zdrój', desc: 'Nowoczesny obiekt w znanym uzdrowisku...', priceSingle: 'ok. 9 100 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 7 400 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 308 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Polanica+Resort+%26+Spa' }
            ]},
            's': { name: 'Południe', hotels: [
                { name: 'Hotel Aries & Spa, Zakopane', desc: 'Luksusowy hotel w samym sercu Krupówek...', priceSingle: 'ok. 12 000 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 9 800 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 408 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Aries+%26+Spa+Zakopane' },
                { name: 'Poziom 511 Design Hotel & Spa, Jura', desc: 'Nowoczesny hotel wkomponowany w skały...', priceSingle: 'ok. 10 700 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 8 800 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 367 PLN', googleMapsLink: 'https://www.google.com/maps/place/Poziom+511+Design+Hotel+%26+Spa' }
            ]},
            'se': { name: 'Południowy-Wschód', hotels: [
                { name: 'Hotel Arłamów, Bieszczady', desc: 'Ogromny kompleks z niezliczonymi atrakcjami...', priceSingle: 'ok. 11 200 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 9 100 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 379 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Ar%C5%82am%C3%B3w' },
                { name: 'Hotel Bristol Tradition & Luxury, Rzeszów', desc: 'Elegancki hotel w centrum Rzeszowa...', priceSingle: 'ok. 8 900 PLN (12 pokoi 1-os.)', priceDouble: 'ok. 7 200 PLN (6 pokoi 2-os.)', pricePerPerson: 'ok. 300 PLN', googleMapsLink: 'https://www.google.com/maps/place/Hotel+Bristol+Tradition+%26+Luxury' }
            ]}
        };
        
        const RESET_CODE = '632';

        // Local Storage Utility Functions
        function getLocalStorageData(key, defaultValue) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : defaultValue;
        }

        function setLocalStorageData(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }
        
        // Initial Data for Polls
        let pollOptions = getLocalStorageData('pollOptions', {
            region: Object.values(hotelData).map(region => region.name),
            weekend: ['3-5 Października', '10-12 Października', '17-19 Października', '24-26 Października', '31 Października-2 Listopada', '7-9 Listopada', '14-16 Listopada', '21-23 Listopada', '28-30 Listopada'],
            price: ['do 100 zł', '100-200 zł', '200-300 zł', 'powyżej 300 zł']
        });
        
        let pollVotes = getLocalStorageData('pollVotes', {
            region: [],
            weekend: [],
            price: []
        });

        // DOM Elements
        const gridContainer = document.getElementById('region-grid');
        const detailsContainer = document.getElementById('details-container');
        
        const regionVoteForm = document.getElementById('region-vote-form');
        const voteRegionButtonsContainer = document.getElementById('vote-region-buttons');
        const addRegionForm = document.getElementById('add-region-form');
        const regionVoteMessageEl = document.getElementById('region-vote-message');
        const addRegionMessageEl = document.getElementById('add-region-message');
        const regionVoteResultsEl = document.getElementById('region-vote-results');
        const resetRegionBtn = document.getElementById('reset-region-btn');
        const regionResetCodeInput = document.getElementById('region-reset-code');
        const regionResetMessageEl = document.getElementById('region-reset-message');

        const weekendVoteForm = document.getElementById('weekend-vote-form');
        const voteWeekendButtonsContainer = document.getElementById('vote-weekend-buttons');
        const addWeekendForm = document.getElementById('add-weekend-form');
        const weekendVoteMessageEl = document.getElementById('weekend-vote-message');
        const addWeekendMessageEl = document.getElementById('add-weekend-message');
        const weekendVoteResultsEl = document.getElementById('weekend-vote-results');
        const resetWeekendBtn = document.getElementById('reset-weekend-btn');
        const weekendResetCodeInput = document.getElementById('weekend-reset-code');
        const weekendResetMessageEl = document.getElementById('weekend-reset-message');
        
        const priceVoteForm = document.getElementById('price-vote-form');
        const votePriceButtonsContainer = document.getElementById('vote-price-buttons');
        const addPriceForm = document.getElementById('add-price-form');
        const priceVoteMessageEl = document.getElementById('price-vote-message');
        const addPriceMessageEl = document.getElementById('add-price-message');
        const priceVoteResultsEl = document.getElementById('price-vote-results');
        const resetPriceBtn = document.getElementById('reset-price-btn');
        const priceResetCodeInput = document.getElementById('price-reset-code');
        const priceResetMessageEl = document.getElementById('price-reset-message');
        
        // New elements for stats
        const secretCodeInput = document.getElementById('secret-code-input');
        const showStatsBtn = document.getElementById('show-stats-btn');
        const statsContainer = document.getElementById('stats-container');
        const visitCountEl = document.getElementById('visit-count');

        // Functions
        function renderGrid() {
            gridContainer.innerHTML = '';
            Object.keys(hotelData).forEach(key => {
                const region = hotelData[key];
                const button = document.createElement('button');
                button.className = 'region-btn text-sm sm:text-base font-semibold p-4 sm:p-6 rounded-lg border-2 border-stone-200 bg-stone-50 hover:bg-stone-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400';
                button.textContent = region.name;
                button.dataset.regionKey = key;
                gridContainer.appendChild(button);
            });
        }
        
        function renderVoteButtons(options, container, key) {
            container.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = `${key}-btn text-sm sm:text-base font-semibold p-2 rounded-lg border-2 border-stone-200 bg-stone-50 hover:bg-blue-600 hover:text-white transition-colors duration-200`;
                button.textContent = option;
                button.dataset[key] = option;
                container.appendChild(button);
            });
        }

        function updateAllVoteButtons() {
            renderVoteButtons(pollOptions.region, voteRegionButtonsContainer, 'region');
            renderVoteButtons(pollOptions.weekend, voteWeekendButtonsContainer, 'weekend');
            renderVoteButtons(pollOptions.price, votePriceButtonsContainer, 'price');
        }

        function displayRegionDetails(regionKey) {
            const region = hotelData[regionKey];
            if (!region) return;

            detailsContainer.innerHTML = '';
            const wrapper = document.createElement('div');
            wrapper.className = 'fade-in';
            
            const header = document.createElement('h2');
            header.className = 'text-3xl font-bold text-center text-stone-700 mb-6';
            header.textContent = `Propozycje dla regionu: ${region.name}`;
            wrapper.appendChild(header);

            const hotelsGrid = document.createElement('div');
            hotelsGrid.className = 'grid md:grid-cols-2 gap-6';

            region.hotels.forEach(hotel => {
                const card = `
                    <div class="bg-white p-6 rounded-2xl shadow-lg flex flex-col">
                        <h3 class="text-xl font-bold text-blue-600 mb-2">${hotel.name}</h3>
                        <p class="text-stone-600 mb-4 flex-grow">${hotel.desc}</p>
                        <div class="mt-auto pt-4 border-t border-stone-200">
                            <h4 class="font-semibold text-stone-700 mb-2">Szacunkowy koszt pobytu (12 os. / 2 noce):</h4>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between bg-stone-50 p-3 rounded-lg">
                                    <span class="text-sm text-stone-600">Opcja 1 (pokoje 1-os.):</span>
                                    <span class="font-bold text-blue-500">${hotel.priceSingle}</span>
                                </div>
                                <div class="flex items-center justify-between bg-stone-50 p-3 rounded-lg">
                                    <span class="text-sm text-stone-600">Opcja 2 (pokoje 2-os.):</span>
                                    <span class="font-bold text-green-600">${hotel.priceDouble}</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-sm text-stone-600 font-semibold">Cena za osobę/noc:</span>
                                <span class="font-bold text-red-500">${hotel.pricePerPerson}</span>
                            </div>
                            <a href="${hotel.googleMapsLink}" target="_blank" class="flex items-center justify-center mt-4 text-blue-600 hover:text-blue-800 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 mr-1">
                                    <path d="M12 12a3 3 0 100-6 3 3 0 000 6z" />
                                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm0 14.25a4.5 4.5 0 100-9 4.5 4.5 0 000 9z" clip-rule="evenodd" />
                                </svg>
                                <span>Zobacz na mapie</span>
                            </a>
                        </div>
                    </div>
                `;
                hotelsGrid.innerHTML += card;
            });
            
            wrapper.appendChild(hotelsGrid);
            detailsContainer.appendChild(wrapper);
        }
        
        function updateVoteResults(votes, options, resultContainer) {
            if (options.length === 0) {
                 resultContainer.innerHTML = '<p class="text-center text-stone-500">Brak dostępnych opcji do głosowania.</p>';
                 return;
            }
            if (votes.length === 0) {
                resultContainer.innerHTML = '<p class="text-center text-stone-500">Brak oddanych głosów. Bądź pierwszy!</p>';
                return;
            }
            
            const results = {};
            options.forEach(option => {
                results[option] = { count: 0, voters: new Set() };
            });

            votes.forEach(voteDoc => {
                const voterName = voteDoc.name;
                const votedOptions = voteDoc.selected || [];
                votedOptions.forEach(option => {
                    if (results[option]) {
                        results[option].count++;
                        results[option].voters.add(voterName);
                    }
                });
            });

            const sortedResults = Object.entries(results).sort(([, a], [, b]) => b.count - a.count);
            const totalVotesCount = votes.length;
            
            resultContainer.innerHTML = sortedResults.map(([option, data]) => {
                const voterList = Array.from(data.voters).join(', ');
                const percentage = totalVotesCount > 0 ? (data.count / totalVotesCount * 100) : 0;
                return `
                    <div class="mb-4 last:mb-0">
                        <div class="flex items-center justify-between">
                            <span class="font-bold text-stone-700">${option} (${data.count} głosów)</span>
                        </div>
                        <p class="text-sm text-stone-500">Głosy: ${voterList}</p>
                        <div class="h-2 mt-1 bg-blue-200 rounded-full">
                            <div class="h-full bg-blue-600 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateAllResults() {
            updateVoteResults(pollVotes.region, pollOptions.region, regionVoteResultsEl);
            updateVoteResults(pollVotes.weekend, pollOptions.weekend, weekendVoteResultsEl);
            updateVoteResults(pollVotes.price, pollOptions.price, priceVoteResultsEl);
        }

        gridContainer.addEventListener('click', (event) => {
            const target = event.target.closest('.region-btn');
            if (!target) return;

            const regionKey = target.dataset.regionKey;
            
            document.querySelectorAll('.region-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            target.classList.add('active');

            displayRegionDetails(regionKey);
        });
        
        voteRegionButtonsContainer.addEventListener('click', (event) => {
            const target = event.target.closest('.region-btn');
            if (!target) return;
            target.classList.toggle('active');
        });

        voteWeekendButtonsContainer.addEventListener('click', (event) => {
            const target = event.target.closest('.weekend-btn');
            if (!target) return;
            target.classList.toggle('active');
        });
        
        votePriceButtonsContainer.addEventListener('click', (event) => {
            const target = event.target.closest('.price-btn');
            if (!target) return;
            target.classList.toggle('active');
        });

        // Function to handle vote submission
        function handleVote(voterName, selectedOptions, pollKey, messageEl) {
            if (!voterName) {
                messageEl.textContent = 'Proszę wprowadzić swoje imię.';
                messageEl.classList.add('text-orange-500');
                return;
            }
            if (selectedOptions.length === 0) {
                messageEl.textContent = 'Proszę wybrać przynajmniej jedną opcję.';
                messageEl.classList.add('text-orange-500');
                return;
            }

            // Check if voter already exists and update, otherwise add new
            let existingVoteIndex = pollVotes[pollKey].findIndex(v => v.name.toLowerCase() === voterName.toLowerCase());
            
            if (existingVoteIndex > -1) {
                pollVotes[pollKey][existingVoteIndex].selected = selectedOptions;
                messageEl.textContent = `Twój głos został zaktualizowany, ${voterName}!`;
            } else {
                pollVotes[pollKey].push({ name: voterName, selected: selectedOptions });
                messageEl.textContent = `Twój głos został pomyślnie wysłany, ${voterName}!`;
            }

            setLocalStorageData('pollVotes', pollVotes);
            updateAllResults();
            
            // Clear selected buttons
            document.querySelectorAll(`.${pollKey}-btn`).forEach(btn => btn.classList.remove('active'));
            messageEl.classList.remove('text-orange-500', 'text-red-600');
            messageEl.classList.add('text-green-600');
        }

        regionVoteForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const voterName = document.getElementById('voter-name-region').value.trim();
            const selectedButtons = document.querySelectorAll('#vote-region-buttons .region-btn.active');
            const selectedRegions = Array.from(selectedButtons).map(btn => btn.textContent);
            handleVote(voterName, selectedRegions, 'region', regionVoteMessageEl);
        });

        weekendVoteForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const voterName = document.getElementById('voter-name-weekend').value.trim();
            const selectedButtons = document.querySelectorAll('#vote-weekend-buttons .weekend-btn.active');
            const selectedWeekends = Array.from(selectedButtons).map(btn => btn.textContent);
            handleVote(voterName, selectedWeekends, 'weekend', weekendVoteMessageEl);
        });
        
        priceVoteForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const voterName = document.getElementById('voter-name-price').value.trim();
            const selectedButtons = document.querySelectorAll('#vote-price-buttons .price-btn.active');
            const selectedPrices = Array.from(selectedButtons).map(btn => btn.textContent);
            handleVote(voterName, selectedPrices, 'price', priceVoteMessageEl);
        });

        // Functions to handle poll options and reset
        function addPollOption(pollKey, newOption, messageEl) {
            if (!newOption) {
                messageEl.textContent = 'Proszę podać opcję do dodania.';
                messageEl.classList.add('text-red-600');
                return;
            }
            if (pollOptions[pollKey].includes(newOption)) {
                messageEl.textContent = `Ta opcja (${newOption}) już istnieje.`;
                messageEl.classList.add('text-red-600');
                return;
            }

            pollOptions[pollKey].push(newOption);
            pollOptions[pollKey].sort(); // Sort options alphabetically
            setLocalStorageData('pollOptions', pollOptions);

            messageEl.textContent = `Opcja "${newOption}" została dodana pomyślnie.`;
            messageEl.classList.remove('text-red-600');
            messageEl.classList.add('text-green-600');
            
            // Re-render buttons and update results
            updateAllVoteButtons();
            updateAllResults();
        }

        function resetPoll(pollKey, resetCodeInput, messageEl) {
            const enteredCode = resetCodeInput.value;
            if (enteredCode !== RESET_CODE) {
                messageEl.textContent = 'Nieprawidłowy kod resetujący.';
                messageEl.classList.add('text-red-600');
                return;
            }
            
            pollVotes[pollKey] = [];
            setLocalStorageData('pollVotes', pollVotes);
            
            messageEl.textContent = 'Ankieta została pomyślnie zresetowana.';
            messageEl.classList.remove('text-red-600');
            messageEl.classList.add('text-green-600');

            updateAllResults();
            document.querySelectorAll(`.${pollKey}-btn`).forEach(btn => {
                btn.classList.remove('active');
            });
            resetCodeInput.value = '';
        }

        addRegionForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const newRegionName = document.getElementById('new-region-name').value.trim();
            addPollOption('region', newRegionName, addRegionMessageEl);
            document.getElementById('new-region-name').value = '';
        });
        addWeekendForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const newWeekendName = document.getElementById('new-weekend-name').value.trim();
            addPollOption('weekend', newWeekendName, addWeekendMessageEl);
            document.getElementById('new-weekend-name').value = '';
        });
        addPriceForm.addEventListener('submit', (event) => {
            event.preventDefault();
            const newPriceName = document.getElementById('new-price-name').value.trim();
            addPollOption('price', newPriceName, addPriceMessageEl);
            document.getElementById('new-price-name').value = '';
        });

        resetRegionBtn.addEventListener('click', () => {
            resetPoll('region', regionResetCodeInput, regionResetMessageEl);
        });
        resetWeekendBtn.addEventListener('click', () => {
            resetPoll('weekend', weekendResetCodeInput, weekendResetMessageEl);
        });
        resetPriceBtn.addEventListener('click', () => {
            resetPoll('price', priceResetCodeInput, priceResetMessageEl);
        });
        
        // Stats functionality
        showStatsBtn.addEventListener('click', () => {
            if (secretCodeInput.value === '632') {
                statsContainer.classList.remove('hidden');
                visitCountEl.textContent = localStorage.getItem('visitCount');
            } else {
                statsContainer.classList.add('hidden');
                // Using a simple alert, as this is a local app and does not break the iframe, but a custom modal would be better for a production app
                alert('Błędny kod!');
            }
        });

        // Initial rendering on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Increment visit count on page load
            let visitCount = parseInt(localStorage.getItem('visitCount') || '0', 10);
            visitCount++;
            localStorage.setItem('visitCount', visitCount);

            renderGrid();
            updateAllVoteButtons();
            updateAllResults();
        });
    </script>
</body>
</html>
